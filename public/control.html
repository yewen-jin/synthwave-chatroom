<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glitch Control Panel</title>
    <style>
        body {
            background: #000;
            color: #0f0;
            font-family: 'Windows', 'VT323', monospace;
            padding: 20px;
        }
        .control-panel {
            border: 1px solid #0f0;
            padding: 20px;
            max-width: 500px;
            margin: 0 auto;
        }
        .control-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="range"] {
            width: 100%;
            margin-bottom: 10px;
        }
        .value-display {
            color: #0f0;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="control-panel">
        <h2>Glitch Control Panel</h2>
        
        <div class="control-group">
            <label for="glitchProbability">Glitch Probability</label>
            <input type="range" id="glitchProbability" min="0" max="1" step="0.1" value="0.1">
            <span class="value-display" id="glitchProbabilityValue">0.1</span>
        </div>

        <div class="control-group">
            <label for="glitchDecay">Glitch Decay Rate</label>
            <input type="range" id="glitchDecay" min="0.1" max="0.99" step="0.01" value="0.9">
            <span class="value-display" id="glitchDecayValue">0.9</span>
        </div>

        <div class="control-group">
            <label for="channelOffset">Channel Offset Range</label>
            <input type="range" id="channelOffset" min="1" max="50" step="1" value="10">
            <span class="value-display" id="channelOffsetValue">10</span>
        </div>

        <div class="control-group">
            <label for="glitchIntensity">Glitch Intensity</label>
            <input type="range" id="glitchIntensity" min="0" max="2" step="0.1" value="1">
            <span class="value-display" id="glitchIntensityValue">1</span>
        </div>

        <div class="control-group">
            <label for="cameraAngle">Camera Angle</label>
            <input type="range" id="cameraAngle" min="-2.0" max="2.0" step="0.1" value="0.0">
            <span class="value-display" id="cameraAngleValue">0.0</span>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        
        // Get all control elements
        const controls = {
            glitchProbability: document.getElementById('glitchProbability'),
            glitchDecay: document.getElementById('glitchDecay'),
            channelOffset: document.getElementById('channelOffset'),
            glitchIntensity: document.getElementById('glitchIntensity'),
            cameraAngle: document.getElementById('cameraAngle')
        };

        // Update value displays and emit changes
        Object.keys(controls).forEach(key => {
            const control = controls[key];
            const valueDisplay = document.getElementById(`${key}Value`);
            
            control.addEventListener('input', () => {
                const data = {
                    parameter: key,
                    value: parseFloat(control.value)
                };
                
                // Debug logging
                console.log('Sending glitch control:', {
                    ...data,
                    timestamp: new Date().toISOString()
                });
                
                valueDisplay.textContent = control.value;
                socket.emit('glitch-control', data);
            });
        });

        // Add connection status logging
        socket.on('connect', () => {
            console.log('Connected to server with ID:', socket.id);
        });

        socket.on('disconnect', () => {
            console.log('Disconnected from server');
        });
    </script>
</body>
</html>