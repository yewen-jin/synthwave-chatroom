import{l as e}from"./vendor-socket-C4-tnvru.js";import{p as t}from"./vendor-p5-C9pDfyzF.js";let n;const s="Symoné";let a,o,i,l,r,d,c,u,m,y,p,g;function h(e){a.appendChild(e),a.scrollTop=a.scrollHeight;e.querySelectorAll("img").forEach(e=>{e.complete||e.addEventListener("load",()=>{a.scrollTop=a.scrollHeight})})}function f(){a&&(a.scrollTop=a.scrollHeight)}function v(){g.style.display="block"}function E(){g.style.display="none"}class b{constructor(){this.dialogueData=null,this.currentNodeId=null,this.variables={}}getCurrentNode(){return this.dialogueData&&this.currentNodeId?this.dialogueData.nodes[this.currentNodeId]:null}getAvailableChoices(){const e=this.getCurrentNode();return e&&e.choices?e.choices.filter(e=>this.evaluateConditions(e.conditions)):[]}evaluateConditions(e){if(!e)return 1;if(e.variable&&e.operator){const t=this.variables[e.variable]??0,n=e.value;switch(e.operator){case">=":return t>=n;case"<=":return t<=n;case">":return t>n;case"<":return t<n;case"==":return t==n;case"!=":return t!=n;default:return 0}}for(let[t,n]of Object.entries(e))if("string"==typeof n){if(n.startsWith(">=")){const e=parseFloat(n.substring(2));if((this.variables[t]||0)<e)return 0}else if(n.startsWith("<=")){const e=parseFloat(n.substring(2));if((this.variables[t]||0)>e)return 0}else if(n.startsWith(">")){const e=parseFloat(n.substring(1));if((this.variables[t]||0)<=e)return 0}else if(n.startsWith("<")){const e=parseFloat(n.substring(1));if((this.variables[t]||0)>=e)return 0}}else if(this.variables[t]!==n)return 0;return 1}isEnded(){const e=this.getCurrentNode();return e&&"ending"===e.type}reset(){var e,t;this.currentNodeId=(null==(e=this.dialogueData)?void 0:e.metadata.startNode)||null,this.variables={...(null==(t=this.dialogueData)?void 0:t.variables)||{}}}getVariables(){return{...this.variables}}setVariables(e){this.variables={...e}}setCurrentNode(e){this.currentNodeId=e}setDialogueData(e){this.dialogueData=e}}window.location.pathname.includes("room2");const w=window.location.pathname.includes("narrator-room"),k=window.location.pathname.includes("player-room.html")||"/player-room"===window.location.pathname;let x=null,I=null,L=null,C=null,B=new Set;function N(e,t,n){I=e,L=t,C=n,w?function(){const e=document.getElementById("dialogue-trigger-btn"),t=document.getElementById("narrator-popup"),n=document.getElementById("narrator-text"),s=document.getElementById("narrator-continue-btn"),a=document.getElementById("dialogue-control-btns"),o=document.getElementById("restart-btn"),i=document.getElementById("end-btn");if(!(e&&t&&n&&s))return;I.emit("request-game-status"),I.on("game-status",t=>{if(t.active){e.disabled=1;const t=e.querySelector(".btn-text");t&&(t.textContent="Transmission Active..."),a&&(a.style.display="flex")}else{e.disabled=0;const t=e.querySelector(".btn-text");t&&(t.textContent="Initiate Transmission"),a&&(a.style.display="none")}}),e.addEventListener("click",()=>{I.emit("dialogue-start",{dialogueId:"thebodyisobsolete",targetRoom:"player-room"}),e.disabled=1;const t=e.querySelector(".btn-text");t&&(t.textContent="Transmission Active..."),a&&(a.style.display="flex")}),o&&o.addEventListener("click",async()=>{await D("Restart the dialogue from the beginning?")&&I.emit("dialogue-restart")});i&&i.addEventListener("click",async()=>{await D("End the dialogue now?")&&I.emit("dialogue-end-manual")});I.on("player-choice-made",e=>{n.textContent=e.isEnding?`Ending: ${e.currentNode}`:`Node: ${e.currentNode}`,t.style.display="flex",s.disabled=1,s.textContent="Server Sending...",setTimeout(()=>{t.style.display="none",s.disabled=0,s.textContent="Continue"},2e3)}),s.addEventListener("click",()=>{}),I.on("dialogue-restart",()=>{t.style.display="none"}),I.on("dialogue-end",()=>{t.style.display="none",e.disabled=0;const n=e.querySelector(".btn-text");n&&(n.textContent="Initiate Transmission"),a&&(a.style.display="none")})}():k&&(x=new b,function(){let e=0;const t=document.getElementById("normal-input-container"),n=document.getElementById("dialogue-choices-inline"),s=document.getElementById("send-btn"),a=document.getElementById("narrator-status");if(!t||!n||!s)return;I.on("narrator-status",t=>{a&&!e&&(a.textContent=t.online?"Online":"Offline",a.classList.toggle("offline",!t.online))}),I.emit("request-narrator-status"),I.on("dialogue-started",()=>{a&&(a.textContent="typing...",a.classList.add("typing"),a.classList.remove("offline"))}),I.on("dialogue-sync",o=>{if(!o.active)return;e=1,x.dialogueData||x.setDialogueData(o.dialogueData),x.setCurrentNode(o.currentNode),x.setVariables(o.variables);const i=o.nodeData||x.getCurrentNode(),l=x.getAvailableChoices(),r=l&&l.length>0,d=i.narratorMessages&&i.narratorMessages.length>0;if(r){if(i.text&&i.text.trim().length>0&&!B.has(o.currentNode)){const e=document.getElementById("chatBody");if(e){const t=document.createElement("div");t.className="system-message",t.innerHTML=i.text,e.appendChild(t),B.add(o.currentNode),f()}}t.style.display="none",s.style.display="none",n.style.display="flex",n.innerHTML="",l.forEach(e=>{const t=document.createElement("button");t.className="choice-btn",t.innerHTML=e.displayText||e.text,t.addEventListener("click",()=>{!function(e){const t=document.getElementById("narrator-status");t&&(t.textContent="typing...",t.classList.add("typing"),t.classList.remove("offline"));const n=document.getElementById("dialogue-choices-inline");n&&(n.style.display="none");const s=document.getElementById("normal-input-container"),a=document.getElementById("send-btn");s&&(s.style.display="block");a&&(a.style.display="block");I.emit("player-choice",{choiceId:e.id,choiceText:e.text||null,username:L})}(e),n.querySelectorAll(".choice-btn").forEach(e=>e.disabled=1)}),n.appendChild(t)}),f(),a&&(a.textContent="Online",a.classList.remove("typing","offline"))}else{if(n.style.display="none",t.style.display="none",s.style.display="none",i.text&&i.text.trim().length>0&&!B.has(o.currentNode)){const e=document.getElementById("chatBody");if(e){const t=document.createElement("div");t.className="system-message",t.innerHTML=i.text,e.appendChild(t),B.add(o.currentNode),f()}}d&&a&&(a.textContent="typing...",a.classList.add("typing"),a.classList.remove("offline"))}C&&C()}),I.on("dialogue-restart",()=>{B.clear(),x&&x.reset(),n.style.display="none"}),I.on("dialogue-end",()=>{e=0,n.style.display="none",t.style.display="block",s.style.display="block",x&&(x.dialogueData=null,x.currentNodeId=null,x.variables={}),B.clear(),a&&(a.classList.remove("typing"),I.emit("request-narrator-status"))})}())}function D(e){return new Promise(t=>{const n=document.getElementById("confirm-popup"),s=document.getElementById("confirm-message"),a=document.getElementById("confirm-yes"),o=document.getElementById("confirm-cancel");function i(){n.style.display="none",a.removeEventListener("click",l),o.removeEventListener("click",r),document.removeEventListener("keydown",d)}function l(){i(),t(1)}function r(){i(),t(0)}function d(e){"Enter"===e.key?(e.preventDefault(),l()):"Escape"===e.key&&(e.preventDefault(),r())}n&&a&&o?(s.textContent=e,n.style.display="flex",a.addEventListener("click",l),o.addEventListener("click",r),document.addEventListener("keydown",d)):t(0)})}let T,S=null,q=k,H=0;var $,M,z,A,j,P,W,_;$=function(){const e=o.value.trim();e&&S&&(window._socket.emit("chat",{text:e,username:S,timestamp:Date.now()}),o.value="")},M=function(){S=r.value.trim(),S&&window._socket.emit("check username",S)},a=document.getElementById("chatBody"),o=document.getElementById("chatInput"),i=document.querySelector(".send-btn"),l=document.getElementById("username-popup"),r=document.getElementById("username-input"),d=document.getElementById("username-submit"),c=document.getElementById("username-no"),u=document.getElementById("custom-username-input"),m=document.getElementById("custom-username-submit"),y=document.getElementById("name-input-container"),p=document.getElementById("yes-no-buttons"),g=document.createElement("p"),g.style.color="#ff0000",g.style.display="none",g.textContent="This name has been taken, please use another one",document.querySelector(".login-content").appendChild(g),i.addEventListener("click",$),o.addEventListener("keypress",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),$())}),d.addEventListener("click",M),c&&c.addEventListener("click",()=>{p.style.display="none",document.getElementById("login-question").style.display="none",y.style.display="block",E()}),m&&m.addEventListener("click",()=>{u&&u.value.trim()&&(r.value=u.value.trim(),M())}),u&&u.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),u.value.trim()&&(r.value=u.value.trim(),M()))}),r.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),M())}),"hidden"===r.type&&document.addEventListener("keydown",e=>{"Enter"===e.key&&"none"!==l.style.display&&(e.preventDefault(),M())}),T=function(){let e=0,n=150;const s=[10,0,40],a=[255,75,180],o=[80,40,255],i=[180,40,255];let l,r=.1,d=.9,c=10,u=1,m=0,y=1200;return new t(t=>{t.setup=()=>{let e=t.createCanvas(t.windowWidth,t.windowHeight,t.WEBGL);e.position(0,0),e.style("z-index","-1"),l=0},t.draw=()=>{t.background(s),t.random(1)<r&&(m=1),t.push(),t.translate(0,-280,280),t.noStroke();for(let e=0;e<t.height/2;e++){let n=t.map(e,0,t.height/2,0,1),s=t.lerpColor(t.color(80,0,100),t.color(255,60,180),n);m?(t.fill(t.color(255,0,0)),t.rect(-t.width+t.random(-c,c)*u,e+t.random(-2,2),2*t.width,1),t.fill(t.color(0,255,0)),t.rect(-t.width+t.random(-c,c)*u,e+t.random(-2,2),2*t.width,1),t.fill(t.color(0,0,255)),t.rect(-t.width+t.random(-c,c)*u,e+t.random(-2,2),2*t.width,1)):(t.fill(s),t.rect(-t.width,e,2*t.width,1))}t.pop(),m?(t.rotateX(l+t.random(-.05,.05)*u),t.translate(t.random(-5,5)*u,100,0)):(t.rotateX(l),t.translate(0,100,0)),t.push(),t.translate(0,-500,-1e3),t.noStroke(),m?(t.fill(a[0],a[1],a[2],50),t.circle(t.random(-c,c)*u,t.random(-c,c)*u,1.5*n)):(t.fill(a[0],a[1],a[2],50),t.circle(0,0,1.5*n)),t.fill(a[0],a[1],a[2]),t.circle(0,0,n),t.pop(),t.strokeWeight(1);for(let n=0;n<2e3;n+=30){let s=t.map(n,0,2e3,255,0);if(t.stroke(o[0],o[1],o[2],s),m){let s=t.random(-c,c)*u;t.line(-1200+s,0,n+e,y+s,0,n+e)}else t.line(-1200,0,n+e,y,0,n+e)}for(let n=-1200;n<=y;n+=30){let s=t.dist(n,0,0,0),a=t.map(s,0,y,255,100);if(t.stroke(i[0],i[1],i[2],a),m){let s=t.random(-c,c)*u;t.line(n+s,0,0+e,n+s,0,2e3+e)}else t.line(n,0,0+e,n,0,2e3+e)}m&&t.random(1)<d&&(m=0),e-=.5,e<=-30&&(e=0)},t.windowResized=()=>{t.resizeCanvas(t.windowWidth,t.windowHeight)}}),{setGlitchProbability:e=>{r=e},setGlitchDecay:e=>{d=e},setChannelOffset:e=>{c=e},setGlitchIntensity:e=>{u=e},setCameraAngle:e=>{l=Math.PI/3*e},flash:()=>{n=200,m=1,setTimeout(()=>{n=150},200)}}}(),function(){const e=document.querySelector(".maximize"),t=document.querySelector(".msn-window"),n=document.querySelector(".title-bar");let s,a,o,i,l=0,r=0,d=0;n.addEventListener("mousedown",function(e){if(t.classList.contains("maximized"))return;o=e.clientX-r,i=e.clientY-d,e.target===n&&(l=1)}),document.addEventListener("mousemove",function(e){l&&(e.preventDefault(),s=e.clientX-o,a=e.clientY-i,r=s,d=a,n=s,c=a,t.style.transform=`translate(${n}px, ${c}px)`);var n,c}),document.addEventListener("mouseup",function(){o=s,i=a,l=0}),e.addEventListener("click",()=>{t.classList.toggle("maximized"),t.classList.contains("maximized")?(l=0,n.style.cursor="default"):n.style.cursor="grab",e.textContent=t.classList.contains("maximized")?"❐":"□"})}(),window._socket=(z=function(e){const t=document.createElement("div");if(e.isSystem){const n=e.speaker?" speaker-message":"";return t.className=`message system-message-inline${n}`,e.speaker?(t.dataset.speaker=e.speaker,t.innerHTML=`<span class="speaker-name">${e.speaker}:</span> <span class="text">${e.text}</span>`):t.innerHTML=`<span class="text">${e.text}</span>`,h(t),void(T&&T.flash())}if(e.isImage){t.className="message image-message";const n=document.createElement("img");return n.src=e.imageUrl,n.alt=e.imageAlt||"",n.loading="lazy",t.appendChild(n),h(t),void(T&&T.flash())}t.className="message "+(e.username===S?"mine":"others"),t.innerHTML=`\n    <span class="user-id">${e.username}:</span>\n    <span class="text">${e.text}</span>\n    <span class="timestamp">${new Date(e.timestamp).toLocaleTimeString()}</span>\n  `,h(t),T&&T.flash()},A=function(e){const{username:t,isPlayer:n}=e,a=document.createElement("div");a.className="system-message",a.innerHTML=`<i><strong>${t}</strong> entered the chat</i>`,h(a),function(e){const t=document.getElementById("last-joined-user");t&&e!==s&&"Liz"!==e&&(t.textContent=e)}(t),n&&function(e){const t=document.getElementById("last-joined-player");t&&e!==s&&"Liz"!==e&&(t.textContent=e)}(t)},j=function(e){const t=document.createElement("div");t.className="system-message",t.innerHTML=`<i><strong>${e}</strong> left the chat</i>`,h(t)},P=function(e){e?v():(localStorage.setItem("username",S),function(e){const t=document.getElementById("user-display-name");t&&(t.textContent=e)}(S),l.style.display="none",E(),!w&&!k||H||(H=1,N(window._socket,S)),window._socket.emit("user joined",{username:S,isPlayer:q}))},W=function(){v()},_=function(e){if(T)switch(e.parameter){case"glitchProbability":T.setGlitchProbability(e.value);break;case"glitchDecay":T.setGlitchDecay(e.value);break;case"channelOffset":T.setChannelOffset(e.value);break;case"glitchIntensity":T.setGlitchIntensity(e.value);break;case"cameraAngle":T.setCameraAngle(e.value)}},n=e("localhost"===window.location.hostname?"http://localhost:3000":window.location.origin,{withCredentials:1,transports:["websocket","polling"]}),n.on("chat",z),n.on("user joined",A),n.on("user left",j),n.on("username response",P),n.on("username taken",W),n.on("glitch-control",_),n.on("theme-change",e=>{document.body.classList.remove("palette-purple","palette-blue","palette-green"),e&&document.body.classList.add(e)}),window._socket=n,n),window._socket.on("reconnect",()=>{S&&window._socket.emit("user joined",{username:S,isPlayer:q})}),l.style.display="flex";
