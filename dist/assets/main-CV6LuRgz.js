import{l as e}from"./vendor-socket-DF7vOrqd.js";import{p as t}from"./vendor-p5-Lav6aMd4.js";const n=window.location.pathname.includes("room2");let a,o,s,i,l,r,c;function d(e){a.appendChild(e),a.scrollTop=a.scrollHeight}function u(){c.style.display="block"}function m(e){const t=document.getElementById("user-display-name");t&&(t.textContent=e)}window.location.pathname.includes("narrator-room");class h{constructor(){this.dialogueData=null,this.currentNodeId=null,this.variables={}}async loadDialogue(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`Failed to load dialogue: ${t.status}`);return this.dialogueData=await t.json(),this.currentNodeId=this.dialogueData.metadata.startNode,this.variables={...this.dialogueData.variables},1}catch(t){return 0}}getCurrentNode(){return this.dialogueData&&this.currentNodeId?this.dialogueData.nodes[this.currentNodeId]:null}getAvailableChoices(){const e=this.getCurrentNode();return e&&e.choices?e.choices.filter(e=>this.evaluateConditions(e.conditions)):[]}evaluateConditions(e){if(!e)return 1;for(let[t,n]of Object.entries(e))if("string"==typeof n){if(n.startsWith(">=")){const e=parseFloat(n.substring(2));if((this.variables[t]||0)<e)return 0}else if(n.startsWith("<=")){const e=parseFloat(n.substring(2));if((this.variables[t]||0)>e)return 0}else if(n.startsWith(">")){const e=parseFloat(n.substring(1));if((this.variables[t]||0)<=e)return 0}else if(n.startsWith("<")){const e=parseFloat(n.substring(1));if((this.variables[t]||0)>=e)return 0}}else if(this.variables[t]!==n)return 0;return 1}applyEffects(e){if(e)for(let[t,n]of Object.entries(e))"string"==typeof n?n.startsWith("+")?this.variables[t]=(this.variables[t]||0)+parseFloat(n.substring(1)):n.startsWith("-")?this.variables[t]=(this.variables[t]||0)-parseFloat(n.substring(1)):this.variables[t]=n:this.variables[t]=n}selectChoice(e){const t=this.getAvailableChoices().find(t=>t.id===e);return t?(this.applyEffects(t.effects),this.currentNodeId=t.nextNode,this.getCurrentNode()):null}isEnded(){const e=this.getCurrentNode();return e&&"ending"===e.type}reset(){var e,t;this.currentNodeId=(null==(e=this.dialogueData)?void 0:e.metadata.startNode)||null,this.variables={...(null==(t=this.dialogueData)?void 0:t.variables)||{}}}getVariables(){return{...this.variables}}setVariables(e){this.variables={...e}}setCurrentNode(e){this.currentNodeId=e}setDialogueData(e){this.dialogueData=e}}let p=null,y=null,g=null,f=null,w=0,b=new Set;const v=window.location.pathname.includes("player-room.html")||"/player-room"===window.location.pathname,E=window.location.pathname.includes("narrator-room");function x(e,t,n,a){y=e,g=t,f=a,E?function(){const e=document.getElementById("dialogue-trigger-btn"),t=document.getElementById("narrator-popup"),n=document.getElementById("narrator-text"),a=document.getElementById("narrator-continue-btn");if(!(e&&t&&n&&a))return;e.addEventListener("click",()=>{y.emit("dialogue-start",{dialogueId:"thebodyisobsolete",targetRoom:"player-room"}),e.disabled=1;const t=e.querySelector(".btn-text");t&&(t.textContent="Transmission Active...")}),y.on("player-choice-made",e=>{w=1,n.textContent=e.narratorResponse,t.style.display="flex",a.disabled=1,a.textContent="Server Sending...",setTimeout(()=>{t.style.display="none",a.disabled=0,a.textContent="Continue"},2e3)}),a.addEventListener("click",()=>{}),y.on("dialogue-end",()=>{w=0,t.style.display="none",e.disabled=0;const n=e.querySelector(".btn-text");n&&(n.textContent="Initiate Transmission")})}():v&&(p=new h,function(){const e=document.getElementById("normal-input-container"),t=document.getElementById("dialogue-choices-inline"),n=document.getElementById("send-btn"),a=document.getElementById("narrator-status");if(!e||!t||!n)return;y.on("narrator-status",e=>{a&&!w&&(a.textContent=e.online?"Online":"Offline",a.classList.toggle("offline",!e.online))}),y.emit("request-narrator-status"),y.on("dialogue-started",()=>{a&&(a.textContent="typing...",a.classList.add("typing"),a.classList.remove("offline"))}),y.on("dialogue-sync",o=>{if(!o.active)return;w=1,p.dialogueData||p.setDialogueData(o.dialogueData),p.setCurrentNode(o.currentNode),p.setVariables(o.variables);const s=o.nodeData||p.getCurrentNodeData(),i=p.getAvailableChoices(),l=i&&i.length>0,r=s.narratorMessages&&s.narratorMessages.length>0;if(l){if(s.text&&s.text.trim().length>0&&!b.has(o.currentNode)){const e=document.getElementById("chatBody");if(e){const t=document.createElement("div");t.className="system-message",t.textContent=s.text,e.appendChild(t),e.scrollTop=e.scrollHeight,b.add(o.currentNode)}}e.style.display="none",n.style.display="none",t.style.display="flex",t.innerHTML="",i.forEach(e=>{const n=document.createElement("button");n.className="choice-btn",n.textContent=e.text,n.addEventListener("click",()=>{!function(e){const t=document.getElementById("narrator-status");t&&(t.textContent="typing...",t.classList.add("typing"),t.classList.remove("offline"));const n=document.getElementById("dialogue-choices-inline");n&&(n.style.display="none");const a=document.getElementById("normal-input-container"),o=document.getElementById("send-btn");a&&(a.style.display="block");o&&(o.style.display="block");y.emit("player-choice",{choiceId:e.id,choiceText:e.text,username:g})}(e),t.querySelectorAll(".choice-btn").forEach(e=>e.disabled=1)}),t.appendChild(n)}),a&&(a.textContent="Online",a.classList.remove("typing","offline"))}else{if(t.style.display="none",e.style.display="none",n.style.display="none",s.text&&s.text.trim().length>0&&!b.has(o.currentNode)){const e=document.getElementById("chatBody");if(e){const t=document.createElement("div");t.className="system-message",t.textContent=s.text,e.appendChild(t),e.scrollTop=e.scrollHeight,b.add(o.currentNode)}}r&&a&&(a.textContent="typing...",a.classList.add("typing"),a.classList.remove("offline"))}f&&f()}),y.on("dialogue-end",()=>{w=0,t.style.display="none",e.style.display="block",n.style.display="block",b.clear(),a&&(a.classList.remove("typing"),y.emit("request-narrator-status"))})}())}let C,k=n?localStorage.getItem("username"):null,I=0;function L(e){const t=document.createElement("div");if(e.isSystem)return t.className="message system-message-inline",t.innerHTML=`<span class="text">${e.text}</span>`,d(t),void(C&&C.flash());if(e.isImage){t.className="message image-message";const n=document.createElement("img");return n.src=e.imageUrl,n.alt=e.imageAlt||"",n.loading="lazy",t.appendChild(n),d(t),void(C&&C.flash())}t.className="message "+(e.username===k?"mine":"others"),t.innerHTML=`\n    <span class="user-id">${e.username}:</span>\n    <span class="text">${e.text}</span>\n    <span class="timestamp">${new Date(e.timestamp).toLocaleTimeString()}</span>\n  `,d(t),C&&C.flash()}var N,D,B,S,T;N=function(){const e=o.value.trim();e&&k&&(window._socket.emit("chat",{text:e,username:k,timestamp:Date.now()}),o.value="")},D=function(){k=l.value.trim(),k&&window._socket.emit("check username",k)},a=document.getElementById("chatBody"),o=document.getElementById("chatInput"),s=document.querySelector(".send-btn"),i=document.getElementById("username-popup"),l=document.getElementById("username-input"),r=document.getElementById("username-submit"),c=document.createElement("p"),c.style.color="#ff0000",c.style.display="none",c.textContent="This name has been taken, please use another one",document.querySelector(".login-content").appendChild(c),s.addEventListener("click",N),o.addEventListener("keypress",e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),N())}),r.addEventListener("click",D),l.addEventListener("keypress",e=>{"Enter"===e.key&&(e.preventDefault(),D())}),n&&document.addEventListener("keydown",e=>{"Enter"===e.key&&"none"!==i.style.display&&(e.preventDefault(),D())}),n&&(null==(B=document.querySelector(".msn-window"))||B.classList.add("room2-window"),null==(S=document.querySelector(".title-bar"))||S.classList.add("room2-title"),null==(T=document.querySelector(".chat-area"))||T.classList.add("room2-chat-area")),C=function(){let e=0,n=150;const a=[10,0,40],o=[255,75,180],s=[80,40,255],i=[180,40,255];let l,r=.1,c=.9,d=10,u=1,m=0,h=1200;return new t(t=>{t.setup=()=>{let e=t.createCanvas(t.windowWidth,t.windowHeight,t.WEBGL);e.position(0,0),e.style("z-index","-1"),l=0},t.draw=()=>{t.background(a),t.random(1)<r&&(m=1),t.push(),t.translate(0,-280,280),t.noStroke();for(let e=0;e<t.height/2;e++){let n=t.map(e,0,t.height/2,0,1),a=t.lerpColor(t.color(80,0,100),t.color(255,60,180),n);m?(t.fill(t.color(255,0,0)),t.rect(-t.width+t.random(-d,d)*u,e+t.random(-2,2),2*t.width,1),t.fill(t.color(0,255,0)),t.rect(-t.width+t.random(-d,d)*u,e+t.random(-2,2),2*t.width,1),t.fill(t.color(0,0,255)),t.rect(-t.width+t.random(-d,d)*u,e+t.random(-2,2),2*t.width,1)):(t.fill(a),t.rect(-t.width,e,2*t.width,1))}t.pop(),m?(t.rotateX(l+t.random(-.05,.05)*u),t.translate(t.random(-5,5)*u,100,0)):(t.rotateX(l),t.translate(0,100,0)),t.push(),t.translate(0,-500,-1e3),t.noStroke(),m?(t.fill(o[0],o[1],o[2],50),t.circle(t.random(-d,d)*u,t.random(-d,d)*u,1.5*n)):(t.fill(o[0],o[1],o[2],50),t.circle(0,0,1.5*n)),t.fill(o[0],o[1],o[2]),t.circle(0,0,n),t.pop(),t.strokeWeight(1);for(let n=0;n<2e3;n+=30){let a=t.map(n,0,2e3,255,0);if(t.stroke(s[0],s[1],s[2],a),m){let a=t.random(-d,d)*u;t.line(-1200+a,0,n+e,h+a,0,n+e)}else t.line(-1200,0,n+e,h,0,n+e)}for(let n=-1200;n<=h;n+=30){let a=t.dist(n,0,0,0),o=t.map(a,0,h,255,100);if(t.stroke(i[0],i[1],i[2],o),m){let a=t.random(-d,d)*u;t.line(n+a,0,0+e,n+a,0,2e3+e)}else t.line(n,0,0+e,n,0,2e3+e)}m&&t.random(1)<c&&(m=0),e-=.5,e<=-30&&(e=0)},t.windowResized=()=>{t.resizeCanvas(t.windowWidth,t.windowHeight)}}),{setGlitchProbability:e=>{r=e},setGlitchDecay:e=>{c=e},setChannelOffset:e=>{d=e},setGlitchIntensity:e=>{u=e},setCameraAngle:e=>{l=Math.PI/3*e},flash:()=>{n=200,m=1,setTimeout(()=>{n=150},200)}}}(),function(){const e=document.querySelector(".maximize"),t=document.querySelector(".msn-window"),n=document.querySelector(".title-bar");let a,o,s,i,l=0,r=0,c=0;n.addEventListener("mousedown",function(e){if(t.classList.contains("maximized"))return;s=e.clientX-r,i=e.clientY-c,e.target===n&&(l=1)}),document.addEventListener("mousemove",function(e){l&&(e.preventDefault(),a=e.clientX-s,o=e.clientY-i,r=a,c=o,n=a,d=o,t.style.transform=`translate(${n}px, ${d}px)`);var n,d}),document.addEventListener("mouseup",function(){s=a,i=o,l=0}),e.addEventListener("click",()=>{t.classList.toggle("maximized"),t.classList.contains("maximized")?(l=0,n.style.cursor="default"):n.style.cursor="grab",e.textContent=t.classList.contains("maximized")?"❐":"□"})}(),window._socket=function(t,n,a,o,s,i){const l=e("localhost"===window.location.hostname?"http://localhost:3000":window.location.origin,{withCredentials:1,transports:["websocket","polling"]});return l.on("chat",t),l.on("user joined",n),l.on("user left",a),l.on("username response",o),l.on("username taken",s),l.on("glitch-control",i),l.on("theme-change",e=>{document.body.classList.remove("palette-purple","palette-blue","palette-green"),e&&document.body.classList.add(e)}),window._socket=l,l}(L,function(e){const t=document.createElement("div");t.className="system-message",t.innerHTML=`<i><strong>${e}</strong> entered the chat</i>`,d(t),function(e){const t=window.location.pathname.includes("room2"),n=window.location.pathname.includes("narrator-room");if(!t&&!n||"Symoné"===e||"Liz"===e)return;const a=document.getElementById("last-joined-user");a&&(a.textContent=e)}(e)},function(e){const t=document.createElement("div");t.className="system-message",t.innerHTML=`<i><strong>${e}</strong> left the chat</i>`,d(t)},function(e){if(e)u();else{localStorage.setItem("username",k),m(k),i.style.display="none",c.style.display="none";const e=window.location.pathname.includes("narrator-room"),t=window.location.pathname.includes("player-room.html")||"/player-room"===window.location.pathname;!e&&!t||I||(I=1,x(window._socket,k,0,()=>{C&&C.flash()})),window._socket.emit("user joined",k)}},function(){u()},function(e){if(C)switch(e.parameter){case"glitchProbability":C.setGlitchProbability(e.value);break;case"glitchDecay":C.setGlitchDecay(e.value);break;case"channelOffset":C.setChannelOffset(e.value);break;case"glitchIntensity":C.setGlitchIntensity(e.value);break;case"cameraAngle":C.setCameraAngle(e.value)}}),window._socket.on("reconnect",()=>{k&&window._socket.emit("user joined",k)});const q=window.location.pathname.includes("narrator-room"),z=window.location.pathname.includes("player-room.html")||"/player-room"===window.location.pathname;k?(m(k),!q&&!z||I||(I=1,x(window._socket,k,0,()=>{C&&C.flash()})),window._socket.emit("set username",k)):i.style.display="flex";
